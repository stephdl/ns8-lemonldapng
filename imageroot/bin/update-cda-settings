#!/usr/bin/env python3

#
# Copyright (C) 2025 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import subprocess
import sys

# Function to execute podman commands
def run_podman_command:
    return subprocess.run(["podman", "exec", "lemonldapng-app", "/usr/share/lemonldap-ng/bin/lemonldap-ng-cli", "-yes", "1"]

# Read environment variables
cda_status = run_podman_command("get", "cda")

# Convert boolean strings to actual boolean values
cda_enabled = cda_status == "cda = 1"

if not cda_enabled:
    print("Cross Domain Authority is disabled, skipping CDA settings", file=sys.stderr)
    run_podman_command("set", "cda", "0")
else:
    print("CDA is enabled, setting CDA settings", file=sys.stderr)
    run_podman_command("set", "cda", "1")
